(window["webpackJsonpatm-ticket-scanner"]=window["webpackJsonpatm-ticket-scanner"]||[]).push([[0],{20:function(e,t,n){e.exports=n(44)},26:function(e,t,n){},32:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(4),i=n(0),s=n.n(i),o=n(16),u=n.n(o);n(26),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=n(12);n(30);l.initializeApp({apiKey:"AIzaSyDwGFsr2F-ju_u162LengdX2BeGZ_Bh4Xw",authDomain:"atm-voting.firebaseapp.com",databaseURL:"https://atm-voting.firebaseio.com",projectId:"atm-voting",storageBucket:"atm-voting.appspot.com",messagingSenderId:"639364440999",appId:"1:639364440999:web:2185c88196af2cc6"});var h=l,f=n(2),m=n(3),d=n(6),p=n(5),v=n(7),g=(n(32),n(17)),b=n.n(g);function k(e){var t=e.onError,n=e.onScan;return s.a.createElement(b.a,{delay:300,facingMode:"environment",onError:t,onScan:n,style:{width:"100%"}})}var E=n(8),y=n(13);function O(){return s.a.createElement("svg",{enableBackground:"new 0 0 50 50",viewBox:"0 0 50 50"},s.a.createElement("circle",{cx:"25",cy:"25",r:"25",fill:"#25AE88"}),s.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M38 15L22 33 12 25"}))}function w(){return s.a.createElement("svg",{enableBackground:"new 0 0 50 50",viewBox:"0 0 50 50"},s.a.createElement("circle",{cx:"25",cy:"25",r:"25",fill:"#D75A4A"}),s.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M16 34L25 25 34 16"}),s.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M16 16L25 25 34 34"}))}n(40);function j(e){return s.a.createElement("button",Object.assign({className:"button"},e),e.children)}var S=n(19),x=n.n(S);function A(e,t){(new x.a.Synth).toMaster().triggerAttackRelease(e,t)}function N(){A("C6","32n")}function L(){A("G3","4n")}n(41),n(42);var D=function(e){function t(){return Object(f.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){L()}},{key:"render",value:function(){var e=this.props,t=e.error,n=e.onReset;return s.a.createElement("div",{className:"scan-error-container"},s.a.createElement(w,null),s.a.createElement("div",{className:"scan-error-msg"},t),s.a.createElement(j,{onClick:n},"scan again"))}}]),t}(s.a.Component);function F(e){var t=e.name,n=e.result;return void 0===n?s.a.createElement("div",null,t," pending..."):null===n?s.a.createElement("div",null,t," not executed"):s.a.createElement("div",{className:"result-row"},s.a.createElement("div",{className:"result-icon"},n.isValid?s.a.createElement(O,null):s.a.createElement(w,null)),s.a.createElement("div",null,Array.isArray(n.text)?n.text.map(function(e){return s.a.createElement("div",{key:e},e)}):n.text))}function V(e){var t=e.type,n={STAFF:"#5f2799",SPEAKER:"#5f2799",REGULAR:"#a7168f"},a=n.hasOwnProperty(t)?t:"REGULAR",r=n[a];return s.a.createElement("div",{className:"ticket-type",style:{background:r}},a)}var C=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).handleUpdate=function(){n.setState({checks:Object(y.a)(n.props.result.checks.entries())}),N()},n.state={checks:Object(y.a)(n.props.result.checks.entries())},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.result?N():L(),this.props.result.on("update",this.handleUpdate)}},{key:"componentWillUnmount",value:function(){this.props.result.off("update",this.handleUpdate)}},{key:"render",value:function(){var e=this.props.result,t=e.ticketData,n=e.error;if(n)return s.a.createElement(D,{error:n,onReset:this.props.onReset});var a=this.state.checks.map(function(e){var t=Object(E.a)(e,2),n=t[0],a=t[1];return s.a.createElement(F,{key:n,name:n,result:a})});return s.a.createElement("div",{className:"scan-result-container"},s.a.createElement("div",{className:"ticket-data"},s.a.createElement("div",{className:"ticket-data-name"},t.name),s.a.createElement(V,{type:t.type})),a,s.a.createElement(j,{onClick:this.props.onReset},"scan again"))}}]),t}(s.a.Component);n(43);function R(e){var t=Object(i.useState)(navigator.onLine),n=Object(E.a)(t,2),a=n[0],r=n[1];return Object(i.useEffect)(function(){var e=function(){return r(!1)},t=function(){return r(!0)};return window.addEventListener("offline",e),window.addEventListener("online",t),function(){window.removeEventListener("offline",e),window.removeEventListener("online",t)}},[]),s.a.createElement("div",{className:"".concat(e.className," is-online is-online-").concat(a?"true":"false")},s.a.createElement("label",null,"network"),a?"ONLINE":"OFFLINE")}function T(e){var t=e.hashStorage,n=Object(i.useState)(0),a=Object(E.a)(n,2),r=a[0],c=a[1];return Object(i.useEffect)(function(){var e=t.getValue().hashes;c(e.length);var n=function(e){return c(e.hashes.length)};return t.on("update",n),function(){return t.off("update",n)}},[t]),s.a.createElement("div",{className:"".concat(e.className," memory")},s.a.createElement("label",null,"tickets"),r)}function I(e){var t=e.hashStorage,n=Object(i.useState)(0),a=Object(E.a)(n,2),r=a[0],c=a[1];Object(i.useEffect)(function(){var e=t.getValue().updatedAt;c(e),t.update();var n=function(e){return c(e.updatedAt)};return t.on("update",n),function(){return t.off("update",n)}},[t]);var o=r?"".concat(((Date.now()-r)/1e3/60).toFixed(0),"min"):"never";return s.a.createElement("div",{className:"".concat(e.className," sync")},s.a.createElement("label",null,"sync"),o)}function K(e){var t=e.modeStorage,n=Object(i.useState)(0),a=Object(E.a)(n,2),r=a[0],c=a[1];return Object(i.useEffect)(function(){var e=t.getValue(),n=function(e){return c(e)};return c(e),t.on("update",n),function(){return t.off("update",n)}},[t]),s.a.createElement("div",{className:"".concat(e.className," sync"),onClick:function(){return window.confirm("Change mode?")&&t.toggle()}},s.a.createElement("label",null,"mode"),r)}function M(e){return s.a.createElement("div",{className:"settings-panel"},s.a.createElement(R,{className:"settings-panel-item"}),s.a.createElement(T,{className:"settings-panel-item",hashStorage:e.hashStorage}),s.a.createElement(I,{className:"settings-panel-item",hashStorage:e.hashStorage}),s.a.createElement(K,{className:"settings-panel-item",modeStorage:e.modeStorage}))}var B=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).state={error:null,result:null},n.handleScan=function(){var e=Object(c.a)(r.a.mark(function e(t){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",n.continueScanning());case 2:try{a=n.props.validator.check(t),n.setState({result:a})}catch(r){n.setState({error:"invalidTicketFormat: ".concat(t)})}case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleError=function(e){n.setState({error:"scannerError: ".concat(e)})},n.continueScanning=function(){n.setState({result:null,error:null})},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"renderContent",value:function(){var e=this.state,t=this.props,n=e.result,a=e.error;return n?s.a.createElement(C,{result:n,onReset:this.continueScanning}):a?s.a.createElement(D,{error:a,onReset:this.continueScanning}):s.a.createElement(i.Fragment,null,s.a.createElement(k,{onError:this.handleError,onScan:this.handleScan}),s.a.createElement(M,t))}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},"atm12 scnr"),s.a.createElement("main",{className:"App-main"},this.renderContent()))}}]),t}(s.a.Component),U=n(9),W=function(e){function t(e){var n,a=e.ticketData;return Object(f.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this))).ticketData=a,n.checks=new Map,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"registerCheck",value:function(e){this.checks.set(e,void 0)}},{key:"setCheckResult",value:function(e,t){this.checks.set(e,t),this.emit("update")}}]),t}(U.EventEmitter),G=function(){function e(t){var n=t.uid,a=t.name,r=t.type,c=t.error;Object(f.a)(this,e),this.uid=n,this.name=a,this.type=r,this.error=c}return Object(m.a)(e,null,[{key:"fromText",value:function(t){return new e(JSON.parse(t))}}]),e}(),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(f.a)(this,e),this.checks=t}return Object(m.a)(e,[{key:"check",value:function(e){var t=G.fromText(e),n=new W({ticketData:t});return this.checks.forEach(function(){var e=Object(c.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.registerCheck(t.name),e.t0=n,e.t1=t.name,e.next=5,t.func(n.ticketData);case 5:e.t2=e.sent,e.t0.setCheckResult.call(e.t0,e.t1,e.t2);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n}}]),e}(),P=6e5,z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.updatedAt,a=void 0===n?0:n,r=t.hashes,c=void 0===r?[]:r,i=t.expirationTime,s=void 0===i?P:i;Object(f.a)(this,e),this.updatedAt=a,this.hashes=c,this.expirationTime=s}return Object(m.a)(e,[{key:"isOutdated",value:function(){var e=this.updatedAt,t=this.expirationTime;return Date.now()-e>t}}]),e}(),H=function(e){function t(e){var n,a=e.storage,r=e.storageKey,c=e.updater;return Object(f.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this))).storage=a,n.storageKey=r,n.updater=c,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new z({updatedAt:Date.now(),hashes:e});this.storage.setItem(this.storageKey,JSON.stringify(t)),this.emit("update",t)}},{key:"getValue",value:function(){var e={};try{var t=this.storage.getItem(this.storageKey);t&&(e=JSON.parse(t))}catch(n){}return new z(e)}},{key:"update",value:function(){var e=Object(c.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.getValue().isOutdated()){e.next=6;break}return e.next=4,this.updater();case 4:t=e.sent,this.save(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()}]),t}(U.EventEmitter),X=function(e){function t(e){var n,a=e.storage,r=e.storageKey;return Object(f.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this))).storage=a,n.storageKey=r,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"getAvailableModes",value:function(){return["VALIDATE","PARTY","TEST"]}},{key:"toggle",value:function(){var e=this.getAvailableModes(),t=this.getValue(),n=e[e.indexOf(t)+1%e.length];this.save(n)}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"VALIDATE";this.storage.setItem(this.storageKey,e),this.emit("update",e)}},{key:"getValue",value:function(){try{return this.storage.getItem(this.storageKey)||"VALIDATE"}catch(e){}return"VALIDATE"}}]),t}(U.EventEmitter);function _(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(c.a)(r.a.mark(function e(t){var n,a,c;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new TextEncoder).encode(t),e.next=3,crypto.subtle.digest("SHA-256",n);case 3:return a=e.sent,c=Array.from(new Uint8Array(a)),e.abrupt("return",c.map(function(e){return e.toString(16).padStart(2,"0")}).join(""));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Z=new H({storage:window.localStorage,storageKey:"atm-scnr-hashes",updater:function(){var e=Object(c.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.functions().httpsCallable("getHashes"),e.next=3,t();case 3:return n=e.sent,e.abrupt("return",n.data.hashes);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}),$=new X({storage:window.localStorage,storageKey:"atm-scnr-mode"}),q=new J([function(e){var t=e.hashStorage;return t.update(),{name:"offline check",func:function(){var e=Object(c.a)(r.a.mark(function e(n){var a,c,i,s,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.uid,c=t.getValue(),i=c.hashes,e.next=4,_(a);case 4:return s=e.sent,o=i.includes(s),e.abrupt("return",{isValid:o,text:"offline check ".concat(o?"OK":"failed")});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}({hashStorage:Z}),function(e){var t=e.firebase,n=e.modeStorage,a=t.functions().httpsCallable("validateTicket");return{name:"online check",func:function(){var e=Object(c.a)(r.a.mark(function e(t){var c,i,s,o,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=n.getValue(),e.next=4,a({mode:c,ticketData:t});case 4:return i=e.sent,s=i.data,o=s.isValid,u=s.text,e.abrupt("return",{isValid:o,text:u});case 10:return e.prev=10,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t){return e.apply(this,arguments)}}()}}({firebase:h,modeStorage:$})]);u.a.render(s.a.createElement(B,{validator:q,hashStorage:Z,modeStorage:$}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[20,1,2]]]);
//# sourceMappingURL=main.969e90b1.chunk.js.map