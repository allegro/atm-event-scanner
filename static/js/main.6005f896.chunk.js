(window["webpackJsonpatm-ticket-scanner"]=window["webpackJsonpatm-ticket-scanner"]||[]).push([[0],{20:function(e,t,n){e.exports=n(44)},26:function(e,t,n){},32:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(4),o=n(0),i=n.n(o),s=n(16),u=n.n(s),l=(n(26),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function h(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var f=n(12);n(30);f.initializeApp({apiKey:"AIzaSyDwGFsr2F-ju_u162LengdX2BeGZ_Bh4Xw",authDomain:"atm-voting.firebaseapp.com",databaseURL:"https://atm-voting.firebaseio.com",projectId:"atm-voting",storageBucket:"atm-voting.appspot.com",messagingSenderId:"639364440999",appId:"1:639364440999:web:2185c88196af2cc6"});var d=f,p=n(2),m=n(3),v=n(6),g=n(5),b=n(7),k=(n(32),n(17)),E=n.n(k);function w(e){var t=e.onError,n=e.onScan;return i.a.createElement(E.a,{delay:300,facingMode:"environment",onError:t,onScan:n,style:{width:"100%"}})}var y=n(8),O=n(13);function j(){return i.a.createElement("svg",{enableBackground:"new 0 0 50 50",viewBox:"0 0 50 50"},i.a.createElement("circle",{cx:"25",cy:"25",r:"25",fill:"#25AE88"}),i.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M38 15L22 33 12 25"}))}function S(){return i.a.createElement("svg",{enableBackground:"new 0 0 50 50",viewBox:"0 0 50 50"},i.a.createElement("circle",{cx:"25",cy:"25",r:"25",fill:"#D75A4A"}),i.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M16 34L25 25 34 16"}),i.a.createElement("path",{fill:"none",stroke:"#FFF",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M16 16L25 25 34 34"}))}n(40);function A(e){return i.a.createElement("button",Object.assign({className:"button"},e),e.children)}var x=n(19),N=n.n(x);function L(e,t){(new N.a.Synth).toMaster().triggerAttackRelease(e,t)}function C(){L("C6","32n")}function R(){L("G3","4n")}n(41),n(42);var D=function(e){function t(){return Object(p.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){R()}},{key:"render",value:function(){var e=this.props,t=e.error,n=e.onReset;return i.a.createElement("div",{className:"scan-error-container"},i.a.createElement(S,null),i.a.createElement("div",{className:"scan-error-msg"},t),i.a.createElement(A,{onClick:n},"scan again"))}}]),t}(i.a.Component);function F(e){var t=e.name,n=e.result;return void 0===n?i.a.createElement("div",null,t," pending..."):null===n?i.a.createElement("div",null,t," not executed"):i.a.createElement("div",{className:"result-row"},i.a.createElement("div",{className:"result-icon"},n.isValid?i.a.createElement(j,null):i.a.createElement(S,null)),i.a.createElement("div",null,Array.isArray(n.text)?n.text.map(function(e){return i.a.createElement("div",{key:e},e)}):n.text))}function T(e){var t=e.type,n={STAFF:"#5f2799",SPEAKER:"#5f2799",REGULAR:"#a7168f"},a=n.hasOwnProperty(t)?t:"REGULAR",r=n[a];return i.a.createElement("div",{className:"ticket-type",style:{background:r}},a)}var V=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).handleUpdate=function(){n.setState({checks:Object(O.a)(n.props.result.checks.entries())}),C()},n.state={checks:Object(O.a)(n.props.result.checks.entries())},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.result?C():R(),this.props.result.on("update",this.handleUpdate)}},{key:"componentWillUnmount",value:function(){this.props.result.off("update",this.handleUpdate)}},{key:"render",value:function(){var e=this.props.result,t=e.ticketData,n=e.error;if(n)return i.a.createElement(D,{error:n,onReset:this.props.onReset});var a=this.state.checks.map(function(e){var t=Object(y.a)(e,2),n=t[0],a=t[1];return i.a.createElement(F,{key:n,name:n,result:a})});return i.a.createElement("div",{className:"scan-result-container"},i.a.createElement("div",{className:"ticket-data"},i.a.createElement("div",{className:"ticket-data-name"},t.name),i.a.createElement(T,{type:t.type})),a,i.a.createElement(A,{onClick:this.props.onReset},"scan again"))}}]),t}(i.a.Component);n(43);function I(e){var t=Object(o.useState)(navigator.onLine),n=Object(y.a)(t,2),a=n[0],r=n[1];return Object(o.useEffect)(function(){var e=function(){return r(!1)},t=function(){return r(!0)};return window.addEventListener("offline",e),window.addEventListener("online",t),function(){window.removeEventListener("offline",e),window.removeEventListener("online",t)}},[]),i.a.createElement("div",{className:"".concat(e.className," is-online is-online-").concat(a?"true":"false")},i.a.createElement("label",null,"network"),a?"ONLINE":"OFFLINE")}function K(e){var t=e.hashStorage,n=Object(o.useState)(0),a=Object(y.a)(n,2),r=a[0],c=a[1];return Object(o.useEffect)(function(){var e=t.getValue().hashes;c(e.length);var n=function(e){return c(e.hashes.length)};return t.on("update",n),function(){return t.off("update",n)}},[t]),i.a.createElement("div",{className:"".concat(e.className," memory")},i.a.createElement("label",null,"tickets"),r)}function M(e){var t=e.hashStorage,n=Object(o.useState)(0),a=Object(y.a)(n,2),r=a[0],c=a[1];Object(o.useEffect)(function(){var e=t.getValue().updatedAt;c(e),t.update();var n=function(e){return c(e.updatedAt)};return t.on("update",n),function(){return t.off("update",n)}},[t]);var s=r?"".concat(((Date.now()-r)/1e3/60).toFixed(0),"min"):"never";return i.a.createElement("div",{className:"".concat(e.className," sync")},i.a.createElement("label",null,"sync"),s)}function U(e){var t=e.modeStorage,n=Object(o.useState)(0),a=Object(y.a)(n,2),r=a[0],c=a[1];return Object(o.useEffect)(function(){var e=t.getValue(),n=function(e){return c(e)};return c(e),t.on("update",n),function(){return t.off("update",n)}},[t]),i.a.createElement("div",{className:"".concat(e.className," sync"),onClick:function(){return window.confirm("Change mode?")&&t.toggle()}},i.a.createElement("label",null,"mode"),r)}function W(e){return i.a.createElement("div",{className:"settings-panel"},i.a.createElement(I,{className:"settings-panel-item"}),i.a.createElement(K,{className:"settings-panel-item",hashStorage:e.hashStorage}),i.a.createElement(M,{className:"settings-panel-item",hashStorage:e.hashStorage}),i.a.createElement(U,{className:"settings-panel-item",modeStorage:e.modeStorage}))}var B=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(v.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(o)))).state={error:null,result:null},n.handleScan=function(){var e=Object(c.a)(r.a.mark(function e(t){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",n.continueScanning());case 2:try{a=n.props.validator.check(t),n.setState({result:a})}catch(r){n.setState({error:"invalidTicketFormat: ".concat(t)})}case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleError=function(e){n.setState({error:"scannerError: ".concat(e)})},n.continueScanning=function(){n.setState({result:null,error:null})},n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"renderContent",value:function(){var e=this.state,t=this.props,n=e.result,a=e.error;return n?i.a.createElement(V,{result:n,onReset:this.continueScanning}):a?i.a.createElement(D,{error:a,onReset:this.continueScanning}):i.a.createElement(o.Fragment,null,i.a.createElement(w,{onError:this.handleError,onScan:this.handleScan}),i.a.createElement(W,t))}},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},"atm12 scnr"),i.a.createElement("main",{className:"App-main"},this.renderContent()))}}]),t}(i.a.Component),G=n(9),J=function(e){function t(e){var n,a=e.ticketData;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this))).ticketData=a,n.checks=new Map,n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"registerCheck",value:function(e){this.checks.set(e,void 0)}},{key:"setCheckResult",value:function(e,t){this.checks.set(e,t),this.emit("update")}}]),t}(G.EventEmitter),P=function(){function e(t){var n=t.uid,a=t.name,r=t.type,c=t.error;Object(p.a)(this,e),this.uid=n,this.name=a,this.type=r,this.error=c}return Object(m.a)(e,null,[{key:"fromText",value:function(t){return new e(JSON.parse(t))}}]),e}(),z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(p.a)(this,e),this.checks=t}return Object(m.a)(e,[{key:"check",value:function(e){var t=P.fromText(e),n=new J({ticketData:t});return this.checks.forEach(function(){var e=Object(c.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.registerCheck(t.name),e.t0=n,e.t1=t.name,e.next=5,t.func(n.ticketData);case 5:e.t2=e.sent,e.t0.setCheckResult.call(e.t0,e.t1,e.t2);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n}}]),e}(),H=6e5,X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.updatedAt,a=void 0===n?0:n,r=t.hashes,c=void 0===r?[]:r,o=t.expirationTime,i=void 0===o?H:o;Object(p.a)(this,e),this.updatedAt=a,this.hashes=c,this.expirationTime=i}return Object(m.a)(e,[{key:"isOutdated",value:function(){var e=this.updatedAt,t=this.expirationTime;return Date.now()-e>t}}]),e}(),_=function(e){function t(e){var n,a=e.storage,r=e.storageKey,c=e.updater;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this))).storage=a,n.storageKey=r,n.updater=c,n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new X({updatedAt:Date.now(),hashes:e});this.storage.setItem(this.storageKey,JSON.stringify(t)),this.emit("update",t)}},{key:"getValue",value:function(){var e={};try{var t=this.storage.getItem(this.storageKey);t&&(e=JSON.parse(t))}catch(n){}return new X(e)}},{key:"update",value:function(){var e=Object(c.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.getValue().isOutdated()){e.next=6;break}return e.next=4,this.updater();case 4:t=e.sent,this.save(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()}]),t}(G.EventEmitter),Y=function(e){function t(e){var n,a=e.storage,r=e.storageKey;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this))).storage=a,n.storageKey=r,n}return Object(b.a)(t,e),Object(m.a)(t,[{key:"getAvailableModes",value:function(){return["VALIDATE","PARTY","TEST"]}},{key:"toggle",value:function(){var e=this.getAvailableModes(),t=this.getValue(),n=e[e.indexOf(t)+1%e.length];this.save(n)}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"VALIDATE";this.storage.setItem(this.storageKey,e),this.emit("update",e)}},{key:"getValue",value:function(){try{return this.storage.getItem(this.storageKey)||"VALIDATE"}catch(e){}return"VALIDATE"}}]),t}(G.EventEmitter);function Z(e){return $.apply(this,arguments)}function $(){return($=Object(c.a)(r.a.mark(function e(t){var n,a,c;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new TextEncoder).encode(t),e.next=3,crypto.subtle.digest("SHA-256",n);case 3:return a=e.sent,c=Array.from(new Uint8Array(a)),e.abrupt("return",c.map(function(e){return e.toString(16).padStart(2,"0")}).join(""));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var q=new _({storage:window.localStorage,storageKey:"atm-scnr-hashes",updater:function(){var e=Object(c.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.functions().httpsCallable("getHashes"),e.next=3,t();case 3:return n=e.sent,e.abrupt("return",n.data.hashes);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}),Q=new Y({storage:window.localStorage,storageKey:"atm-scnr-mode"}),ee=new z([function(e){var t=e.hashStorage;return t.update(),{name:"offline check",func:function(){var e=Object(c.a)(r.a.mark(function e(n){var a,c,o,i,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.uid,c=t.getValue(),o=c.hashes,e.next=4,Z(a);case 4:return i=e.sent,s=o.includes(i),e.abrupt("return",{isValid:s,text:"offline check ".concat(s?"OK":"failed")});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}({hashStorage:q}),function(e){var t=e.firebase,n=e.modeStorage,a=t.functions().httpsCallable("validateTicket");return{name:"online check",func:function(){var e=Object(c.a)(r.a.mark(function e(t){var c,o,i,s,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=n.getValue(),e.next=4,a({mode:c,ticketData:t});case 4:return o=e.sent,i=o.data,s=i.isValid,u=i.text,e.abrupt("return",{isValid:s,text:u});case 10:return e.prev=10,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t){return e.apply(this,arguments)}}()}}({firebase:d,modeStorage:Q})]);u.a.render(i.a.createElement(B,{validator:ee,hashStorage:q,modeStorage:Q}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/atm-event-scanner",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/atm-event-scanner","/service-worker.js");l?(!function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):h(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):h(t,e)})}}()}},[[20,1,2]]]);
//# sourceMappingURL=main.6005f896.chunk.js.map